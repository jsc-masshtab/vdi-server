# GM Smart System (Getmobit)

## Общая информация {#gm-base}

**GM Smart System** — это решение Enterprise уровня для создания единого рабочего окружения конечных пользователей и обеспечения унифицированного безопасного доступа к виртуальной инфраструктуре, телефонной связи и видеоконференциям, а также централизованного управления пользовательским компьютерным оборудованием и сервисами.

**ECP VeiL** и **VeiL VDI** имеет полную программную совместимость и обеспечивает корректную работу с линейкой продуктов **GM Smart System**.

!!! attention "Внимание!"
Для получения доступа к указанным ниже документам и файлам необходимо иметь учетную запись на сайте [lk.getmobit.ru](https://lk.getmobit.ru/cabinet-user/index) (логин и пароль от личного кабинета следует запрашивать в отделе технической поддержки ООО «Гетмобит»)

Документация необходимая для работы с GM Smart System (наиболее актуальные версии документов доступны на вкладке "Документы" в [личном кабинете пользователя Getmobit](https://lk.getmobit.ru/cabinet-user/index)):

* [Руководство администратора](https://lk.getmobit.ru/cabinet-user/download-doc/49);

* [Руководство пользователя](https://lk.getmobit.ru/cabinet-user/download-doc/47);

* [Требования к инфраструктуре](https://lk.getmobit.ru/cabinet-user/download-doc/40).

Программные продукты используемые в работе с GM Smart System (наиболее актуальные версии файлов доступны на вкладке "Файлы" в [личном кабинете пользователя Getmobit](https://lk.getmobit.ru/cabinet-user/index)):

* [Сервер управления (GM Server)](https://lk.getmobit.ru/cabinet-user/companyfile/74);

* [Система мониторинга (GM Server Monitoring)](https://lk.getmobit.ru/cabinet-user/download/76);

* [Программное обеспечение GM-Box (GM-OS)](https://lk.getmobit.ru/cabinet-user/companyfile/81);

* [Приложение VeiL Connect в формате SDApp (SD App Mashtab VeiL)](https://lk.getmobit.ru/cabinet-user/download/90).

Файл лицензии, необходимый для работы, следует скачать из [личного кабинета пользователя Getmobit](https://lk.getmobit.ru/cabinet-user/index) или получить у дистрибьютора продукции GM Smart System.

## Подготовка окружения {#env-prep}

### Инфраструктура VeiL {#veil-env}

Для начала использования системы на базе решения **GM-Box** из линейки продуктов **GM Smart System** необходимо подготовить следующее:

1. Развернуть и настроить облачную платформу **ECP VeiL** согласно [руководству](https://veil.mashtab.org/docs/latest/).

1. Развернуть и настроить брокер подключений **VeiL VDI** – **VeiL Broker** согласно [руководству](https://veil.mashtab.org/vdi-docs/broker/engineer_guide/install/).

### Подготовка виртуальных машин (ВМ) {#virt-machines}

1. Используя подготовленную инфраструктуру VeiL [создать ВМ](https://veil.mashtab.org/docs/latest/base/operator_guide/domains/create/) для установки GM Server. Параметры ВМ должны соответствовать следующим рекомендованным аппаратным требованиям (актуальные данные доступны в документе ["Требования к инфраструктуре"](https://lk.getmobit.ru/cabinet-user/download-doc/40)):

    * Минимум 2 vCPU (ядра процессора)

    * Минимум 16 GB RAM

    * 100 GB HDD

1. На виртуальную машину, выполняющую роль сервера управления следует установить операционную систему Ubuntu 16.04 LTS (64bit) либо иную Linux систему, имеющую менеджер deb пакетов и обладающую поддержкой пакета docker версии не ниже 17.09.0.

1. Для вышеуказанной виртуальной машины необходим статический IP-адрес.

1. Аналогично первому пункту создать необходимое количество ВМ и установить на них операционные системы (ОС), которые планируется использовать в качестве гостевых. Подробнее о подготовке ВМ и установке некоторых ОС читайте в соответствующих разделах руководства, для [Windows](https://veil.mashtab.org/vdi-docs/broker/faq/rdp/example_template_win/) и для [Linux](https://veil.mashtab.org/vdi-docs/broker/faq/rdp/example_template_lin/).

### Подготовка сети предприятия для работы с GM-Box {#network-setup}

Для работы с устройствами GM-Box в сети предприятия рекомендуется развернуть или настроить сервер DHCP, предоставляющий подключаемым устройствам следующую информацию:

* IP-адрес подключенного устройства;

* название домена;

* IP-адрес шлюза по умолчанию;

* IP-адрес сервера имён (DNS);

* IP-адрес сервера точного времени (NTP);

* для автоматического поиска сервера управления GM Server необходимо указать локальный домен в DHCP option 119 — 'Domain Search List'.

Также крайне желательно обеспечить наличие A-записи в DNS, связывающей IP-адрес сервера управления GM Server с именем getmobit.example.site

!!! warning "Предупреждение"
    В случае невыполнения вышеуказанных рекомендаций, то есть при отсутствии DNS-записи и настроенного DHCP сервера, устройство GM-Box не сможет автоматически обнаружить и подключиться к серверу управления GM Server. Таким образом, для каждого устройства GM-Box потребуется ручная настройка параметров сети.

## Установка и запуск

### Установка сервера управления GM Server {#gmserver-install}

Установка сервера управления осуществляется согласно ["Руководству администратора"](https://lk.getmobit.ru/cabinet-user/download-doc/49).

!!! attention "Внимание!"
    Для выполнения работ по инсталляции, обновлению, и перезапуску Сервера управления, установки TLS/SSL сертификатов и настройки параметров операционной системы, необходим доступ к виртуальной машине по ssh (openssh, PUTTY и др. программы) с правами суперпользователя (root). Штатная эксплуатация Сервера управления осуществляется только с использованием веб-консоли Сервера управления.

1. Установите Docker CE [согласно руководству](https://docs.docker.com/install/linux/docker-ce/ubuntu/)

1. Установите пакет сервера управления пользователем с правами суперпользователя (root): 

    ```console
    sudo dpkg -i gmserver_[VERSION]_amd64.deb
    ```
    где [VERSION] — номер версии.

!!! attention "Внимание!"
    Все действия выполняются пользователем с правами суперпользователя (root).
    Для выполнения команд и настроек с правами суперпользователя (root) рекомендуется использовать команду **sudo**.
    Пароль для суперпользователя (root) должен формироваться, храниться и меняться в соответствии с парольными политиками, принятыми в организации.

### Установка системы мониторинга GM Server Monitoring {#gmservmon-install}

Установка сервера управления осуществляется согласно ["Руководству администратора"](https://lk.getmobit.ru/cabinet-user/download-doc/49).

1. Установите пакет сервиса мониторинга:

    ```console    
    dpkg -i gmserver-monitoring_[VERSION]_amd64.deb
    ```
    где [VERSION] — номер версии.

1. Отредактируйте файл **/usr/local/etc/getmobit/docker/config.env** следующим образом:

    ```console
    ELASTIC_HOST=getmobit.example.site
    FLUENTD_HOST=getmobit.example.site
    ...
    JWT_SECRET_KEY=<Произвольная строка>
    ```
    где первые строки содержат DNS имя сервера, на котором запущен сервис мониторинга, а <Произвольная строка> — это набор символов длиной до 1024 элементов, следует задать самостоятельно. Чем длиннее строка, тем ключ надежнее.

### Первичный запуск сервера {#gmserver-firstrun)

Запустите сервер управления GM Server выполнив следующую команду:

```console
systemctl start gmserver
```

Загрузка может занимать до 5 минут. После запуска сервера необходимо выполнить его настройку руководствуясь пунктом [Настройка сервера управления GM Server](#gmserver-setup) настоящего руководства.

## Настройка

### Настройка сервера управления GM Server {#gmserver-setup}

Производится с помощью веб-интерфейса GM Server, для перехода к последнему следует открыть с помощью браузера страницу, расположенную по IP-адресу виртуальной машины на которую был установлен сервер управления, либо, при наличии A-записи в DNS, по адресу getmobit.example.site

В открывшейся форме следует ввести логин и пароль, значения по умолчанию:

Login: superadmin

Password: superadmin

!!! important "Важно"
    В целях обеспечения безопасности и контроля доступа к серверу управления, после первого входа в веб-интерфейс следует изменить и запомнить пароли по умолчанию путем редактирования файла **/usr/local/etc/getmobit/docker/config.env**

Например, следующим образом:

```console
LDAP_USER_LOGIN=admin
LDAP_USER_PASSWORD=mail123#
LDAP_SUPER_USER_LOGIN=superadmin
LDAP_SUPER_USER_PASSWORD=mail123#
```

!!! tip "Совет"
    Для выполнения регулярных задач по администрированию сервера, следует использовать доменные учётные записи, включенные в список администраторов и суперадминистраторов

#### Установка Discovery адреса для GM Server

В веб-интерфейсе GM Server используя пункт меню **Организации**, с помощью двойного щелчка по полю **Адрес**  необходимо задать корректный **Первичный discovery адрес** соответствующий DNS имени сервера управления — http://getmobit.example.site

!!! attention "Внимание"
    Обязательно задавать полный URI адрес с указанием http:// или https://

??? danger "Обходной путь"
    Если нет возможности задать DNS имя или сервер DNS временно неисправен, можно указать ip адрес сервера управления, следующим образом — http://192.168.0.1

#### Установка лицензионного файла {#gm-licence}

Для использования сервера управления GM Server необходимо активировать лицензию. Она определяет набор разрешенных к использованию функций, а также количество  GM-Box, подключаемых к серверу.

В веб-интерфейсе GM Server через меню **Настройки** – **Лицензия** следует загрузить имеющийся файл лицензии. Если всё в порядке, параметры примененной лицензии отобразятся на этой же странице.

!!! tip "Информация"
Файл лицензии необходимо скачать из [личного кабинета](https://lk.getmobit.ru/cabinet-user/index) или получить у дистрибьютора.

#### Добавление пользователя {#gm-adduser}

Для авторизации пользователя в системе доступны локальная учётная запись, а также учётные записи службы каталогов AD.

Создание нового пользователя производится из меню сервера управления GM Server **Пользователи** – **Добавить**.

В появившемся окне **Пользователь** необходимо заполнить следующую информацию:

- **Учетная запись** : gm_user

- **Пароль** : gm_pass

- **Роль** : USER

- **Режим GM-Box** : VeiL

- **VDI хост** : IP-адрес VeiL Broker

- **VDI пользователь** : veil_user

- **VDI пароль** : veil_pass

Таким образом, пользователь GM-Box **gm_user** будет ассоциирован с пользователем VeiL VDI (Broker) **veil_user**, что позволит после входа в GM-Box миновать окно авторизации VeiL Connect, так как учётные данные для последнего будут подставлены автоматически.

!!! tip "Рекомендация"
    При использовании учетной записи AD следует указать логин и пароль аналогично вышеуказанному, в полях **VDI пользователь** и **VDI пароль**. Так как именно эти данные будут переданы в окно входа приложения VeiL Connect и, для авторизации, останется отметить checkbox **LDAP**. При последующих входах авторизация будет происходить автоматически, так как состояние checkbox'a **LDAP** сохранится.

Рекомендации по настройке работы систем со службой каталогов AD находятся в разделе [Использование для авторизации службы каталогов AD](#using-ad)

## Начало работы с устройством GM-Box {#gmbox-start}

!!! info "Информация"
        В зависимости от конкретной модели используемого устройства панель разъемов может иметь те или иные порты и коннекторы, для присоединения внешних приборов и устройств необходимо следовать указаниям из раздела "Подключение устройства" из ["Руководства пользователя"](https://lk.getmobit.ru/cabinet-user/download-doc/47).

Подключение устройства:

- Присоедините к панели разъемов все необходимые устройства (клавиатуру, мышь, монитор(ы))

- Подключите GM-Box к сети, в зависимости от модели устройства и архитектуры сети это может быть проводная или беспроводная сеть.

- Присоедините адаптер питания согласно руководству пользователя.

### Обновление программного обеспечения GM-Box {#gmbox-update}

Выполняется согласно указаниям из раздела "Настройка и управление GM-Box" из документа ["Руководство администратора"](https://lk.getmobit.ru/cabinet-user/download-doc/49):

1. В веб-интерфейсе GM Server через **Обновления** – **Добавить** следует загрузить скачанный файл "Программное обеспечение GM-Box (GM-OS)" — mainline_[VERSION].swu.

1. Далее используя **Задания** – **Добавить** ввести:

    - **Название задания** : обновление GM-Box

    - **Назначить на** : выбрать подключенное устройство

    - **Однократно**

    - **Команда** : Device Update & Reboot

    - **ID обновления** : mainline_[VERSION].swu

1. Нажать сохранить и дождаться перезапуска устройства.

### Установка программного обеспечения VeiL Connect {#veilcon-install}

1. В веб-интерфейсе GM Server через **Приложения** – **Добавить** следует загрузить скачанный файл "Приложение VeiL Connect в формате SDApp (SD App Mashtab VeiL)" — Mashtab-Veil_[VERSION].swu.

1. Далее используя **Задания** – **Добавить** ввести:

    - **название задания** : установка VeiL Connect

    - **Назначить на** : выбрать подключенное устройство

    - **Однократно**

    - **Команда** : Install Application & Reboot

    - **ID обновления** : Mashtab_Veil_[VERSION].swu

1. Нажать сохранить и дождаться перезапуска устройства.

### Вход в систему GM-Box {#gmbox-login}

После включения GM-Box и загрузки системы на экране монитора появится окно для авторизации **Вход в систему**, для входа следует использовать следующие данные:

**Имя пользователя** : gm_user

**Пароль** : gm_pass

В случае, если вход не происходит следует проверить настройки согласно разделу "Подключение к сети" из ["Руководства пользователя"](https://lk.getmobit.ru/cabinet-user/download-doc/47).

Если после успешного входа откроется окно авторизации VeiL Connect следует проверить/ввести верные данные для учётной записи VeiL Broker и/или установить/снять отметку с checkbox **LDAP**.

После выполнения вышеуказанных действий откроется окно VeiL Connect предоставляющее выбор ВМ для подключения. Операции с данным окном выполняются согласно руководству с [описанием "Окна доступных пулов ВМ"](https://veil.mashtab.org/vdi-docs/connect/operator_guide/pools/).

## Использование для авторизации службы каталогов AD {#using-ad}

!!! tip "Совет"
    В целях упрощения процессов, связанных с управлением учётными записями пользователей, рекомендуется использовать одну и ту же службу каталогов AD для синхронизации с VeiL Broker и с GM Server.

### GM Smart System {#gm_ad}

Более подробно о настройке синхронизации данных с корпоративной службой каталогов можно прочесть в ["Руководстве Администратора"](https://lk.getmobit.ru/cabinet-user/download-doc/49).

1. В веб-панели управления GM Server используя **Настройки** – **Синхронизация с AD** заполнить следующие поля:

    - **AD Сервер** : IP-адрес сервера AD

    - **AD Порт** : порт для подключения к серверу AD (по умолчанию 389)

    - **Логин** : имя пользователя AD

    - **Пароль** : пароль пользователя AD

1. После ввода данных нажать кнопку проверить.

1. Обновить страницу браузера и убедиться, что **Статус** изменился на **Синхронизация запущена**.

### VeiL VDI {#veil_ad}

Настройка работы VeiL Broker со службой каталогов производится [согласно указаниям](https://veil.mashtab.org/vdi-docs/broker/operator_guide/ad/).
