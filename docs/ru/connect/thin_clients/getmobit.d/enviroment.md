# Подготовка окружения {#env-prep}

### Инфраструктура VeiL {#veil-env}

Для начала использования системы на базе решения **GM-Box** из линейки продуктов **GM Smart System** необходимо подготовить следующее:

1. Развернуть и настроить облачную платформу **ECP VeiL** согласно [руководству](https://veil.mashtab.org/docs/latest/).

1. Развернуть и настроить брокер подключений **VeiL VDI** --- **VeiL Broker** согласно [руководству](https://veil.mashtab.org/vdi-docs/broker/engineer_guide/install/).

### Подготовка виртуальных машин (ВМ) {#virt-machines}

1. Используя подготовленную инфраструктуру VeiL [создать ВМ](https://veil.mashtab.org/docs/latest/base/operator_guide/domains/create/) для установки GM Server. Параметры ВМ должны соответствовать следующим рекомендованным аппаратным требованиям (актуальные данные доступны в документе "Требования к инфраструктуре"):

    - Виртуальная машина для сервера управления:

        * Минимум 2 vCPU (ядра процессора)

        * Минимум 16 GB RAM

        * 100 GB HDD

    - Выделенный статический IP-адрес, A-запись в DNS с именем getmobit.example.site 

    - Операционная система Ubuntu 16.04, 64bit (или Linux based операционная с поддержкой пакета docker версии не ниже 17.09.0 и менеджера deb пакетов)

1. Аналогично предыдущему пункту создать необходимое количество ВМ и установить на них операционные системы (ОС), которые планируется использовать в качестве гостевых. Подробнее о подготовке ВМ и установке ОС читайте в соответствующих разделах руководства, для [Windows](https://veil.mashtab.org/vdi-docs/broker/faq/rdp/example_template_win/) и для [Linux](https://veil.mashtab.org/vdi-docs/broker/faq/rdp/example_template_lin/).

### Настройка сети {#network-setup}

Для работы устройства GM-Box рекомендуется использовать сервис DHCP, представляющий следующую информацию:

* выдаваемый IP-адрес;

* название домена;

* IP-адрес шлюза по умолчанию;

* IP-адрес сервера имён (DNS);

* IP-адрес сервера точного времени (NTP);

* для автоматического поиска Сервера управления (GM Server) необходимо указать локальный домен в DHCP option 119 --- 'Domain Search List'.

### Установка сервера управления (СУ) GM Server {#gmserver-install}

Установка сервера управления осуществляется согласно "Руководству администратора":

!!! attention "Внимание!"
    Для выполнения работ по инсталляции, обновлению, и перезапуску Сервера управления, установки TLS/SSL сертификатов и настройки параметров операционной системы, необходим доступ к виртуальной машине по ssh (openssh, PUTTY и др. программы) с правами суперпользователя (root). Штатная эксплуатация Сервера управления осуществляется только с использованием веб-консоли Сервера управления.

Установку GM-Server можно выполнить из deb-пакета для Ubuntu 16.04 (x64).

1. Установите Docker CE [согласно инструкции](https://docs.docker.com/install/linux/docker-ce/ubuntu/)

1. Установите пакет Сервера управления пользователем с правами суперпользователя (root): 

    `sudo dpkg -i gmserver_[VERSION]_amd64.deb`
    где [VERSION] --- номер версии.

!!! attention "Внимание!"
    Все действия выполняются пользователем с правами суперпользователя (root).
    Для выполнения команд и настроек с правами суперпользователя (root) рекомендуется использовать команду **sudo**.
    Пароль для суперпользователя (root) должен формироваться, храниться и меняться в соответствии с парольными политиками, принятыми в организации.

### Установка системы мониторинга GM Server Monitoring {#gmservmon-install}

Установка сервера управления осуществляется согласно "Руководству администратора".

### Настройка СУ GM Server {#gmserver-setup}

Настройка СУ производится с помощью веб-интерфейса GM Server, для перехода к последнему следует открыть с помощью браузера страницу, расположенную по IP-адресу ВМ на которую был установлен СУ, либо, при наличии записи в DNS, по адресу getmobit.example.site

В открывшейся форме следует ввести логин и пароль, значения по умолчанию:

Login: superadmin

Password: superadmin

#### Добавление пользователя

Для авторизации пользователя в системе доступны локальная учётная запись, а также учётные записи службы каталогов AD.

Создание нового пользователя производится из меню СУ GM Server **Пользователи** -- **Добавить**.

В появившемся окне **Пользователь** необходимо заполнить следующую информацию:

- **Учетная запись** : gm_user

- **Пароль** : gm_pass

- **Роль** : USER

- **Режим GM-Box** : VeiL

- **VDI хост** : IP-адрес VeiL Broker

- **VDI пользователь** : veil_user

- **VDI пароль** : veil_pass

Таким образом, пользователь GM-Box **gm_user** будет ассоциирован с пользователем VeiL VDI (Broker) **veil_user**, что позволит после входа в GM-Box миновать окно авторизации VeiL Connect, так как учётные данные для последнего будут подставлены автоматически.

!!! tip "Рекомендация"
    При использовании учетной записи AD следует указать логин и пароль аналогично вышеуказанному, в полях **VDI пользователь** и **VDI пароль**. Так как именно эти данные будут переданы в окно входа приложения VeiL Connect и, для авторизации, останется отметить checkbox **LDAP**. При последующих входах авторизация будет происходить автоматически, так как состояние checkbox'a **LDAP** сохранится.

Рекомендации по настройке работы систем со службой каталогов AD находятся в разделе [Использование для авторизации службы каталогов AD](#using-ad)
