# Расчет сети

Проектирование сетевой инфраструктуры необходимо проводить по результатам
анализа утилизации каналов связи при работе пользователей.

Факторами, сильно влияющими на утилизацию каналов связи, являются:

- Тип подключения;
- Разрешение монитора;
- Количество мониторов;
- Сценарий использования;
- Передача данных (проброс флеш-накопителей и т.д.).

Так как при подключении к удаленному рабочему столу происходит потоковая передача
изображения на клиентское устройство, решающим фактором утилизации каналов передачи данных является
изменение изображения на экране. Иными словами, чем более динамичное изображение
на мониторе, тем больше данных передается и наоборот, статичное изображение 
генерирует меньшую нагрузку. 

В таблицах ниже приведены средние и максимальные значения генерируемых нагрузок при
использовании разных протоколов при разных сценариях работы пользователей. Все измерения
проводились при передаче изображения с разрешением **Full HD** 1920×1080 точек.
Стоит отметить, что данные значения являются усредненными, и в разные
временные промежутки времени изображение может становиться более или менее
динамичным, например при выделении большого числа ячеек в редакторе таблиц, 
быстрой прокрутки Web-страниц или вращении 3D модели сложного элемента утилизация сети 
кратковременно увеличивается вследствии повышения динамики изображения.

!!! warning "Внимание!"
     Недостаток пропускной способности сети может вызвать появление артефактов 
     изображения, ухудшение отзывчивости управления, снижение частоты кадров,
     а также замедление передачи данных между клиентом и ВМ.

## Native RDP
 
| Сценарий использования        | Cреднее          | Максимальное          |
|:------------------------------|:----------------:|:---------------------:|
| Бездействие системы           | 50 кбит/с        | 70 кбит/с             |
| Текстовый процессор           | 400 кбит/с       | 1.13 Мбит/с           |
| Табличный процессор           | 357 кбит/с       | 1.59 Мбит/с           |
| Web браузер                   | 2.52 Мбит/с      | 15.2 Мбит/с           |
| Просмотр видео (полный экран) | 5.02 Мбит/с      | 15.3 Мбит/с           |
| CAD                           | 2.34 Мбит/с      | 30 Мбит/с             |

 *таблица 1*

!!! info "Внимание!"
      В зависимости от выполняемых действий и используемого ПО на ВРС средние и максимальные значения могут отличаться от приведенных в таблице 1.
      

## RDP

При использовании **RDP** можно выбрать кодек сжатия изображения: 

- **RemoteFX** - кодек, который не требует аппаратного ускорения (использует **CPU**), при использовании которого могут наблюдаться некоторые потери в качестве изображения. Данный эффект наиболее заметен при 3D проэктировании, просмотр детализированных изображений и т.д.
- **H.264/AVC444** - кодек, для которого требуется поддержка со стороны **GPU**, при использовании которого при достаточной пропускной способности сети не возникает заметной потери качества изображения.
- **H.264/AVC420** в отличие от **H.264/AVC444** не требует аппаратного ускорения (использует **CPU**), при этом по сравнению с тем же **H.264/AVC444** требует более высокую полосу пропускания, при примерно равном качестве изображения.

### гостевая ОС Windows 10 

| Сценарий использования        | RemoteFX среднее | RemoteFX максимальное | H.264/AVC444 среднее | H.264/AVC444 максимальное | 
|:------------------------------|:----------------:|:---------------------:|:--------------------:|:-------------------------:|
| Бездействие системы           | 30 кбит/с        | 50 кбит/с             |                      |                           |
| Текстовый процессор           | 280 кбит/с       | 1.66 Мбит/с           |                      |                           |
| Табличный процессор           | 280 кбит/с       | 1.29 Мбит/с           |                      |                           |
| Web браузер                   | 3.82 Мбит/с      | 27 Мбит/с             |                      |                           |
| Просмотр видео (полный экран) | 13 Мбит/с        | 26 Мбит/с             |                      |                           |
| CAD                           | 3.34 Мбит/с      | 35 Мбит/с             |                      |                           |
 
 *таблица 2*

!!!info "Внимание!"
      В зависимости от выполняемых действий и используемого ПО на ВРС средние и максимальные значения могут отличаться от приведенных в таблице 2.

### гостевая ОС Linux

| Сценарий использования        | RemoteFX среднее | RemoteFX максимальное | 
|:------------------------------|:----------------:|:---------------------:|
| Бездействие системы           | 30 кбит/с        | 50 кбит/с             | 
| Текстовый процессор           | 550 кбит/с       | 4.5 Мбит/с            |
| Табличный процессор           | 1.17 Мбит/с      | 5.1 Мбит/с            |
| Web браузер                   | 1.48 Mbit/s      | 11.4 Мбит/с           |
| Просмотр видео (полный экран) | 13 Мбит/с        | 29 Мбит/с             | 

 *таблица 3*

!!!info "Внимание!"
      В качестве ОС при тестировании использовался Ubuntu 20.04 с окружением рабочего стола Unity, в качестве текстового и табличного процессора использовался пакет LibreOffice. В качестве RDP сервера с передачей звука использовалась связка **xfreerdp** и **pulseaudio**. В зависимости от выполняемых действий и используемого ПО на ВРС средние и максимальные значения могут отличаться от приведенных в таблице 3.
