# Рекомендации к использованию vGPU

Рабочие нагрузки пользователей VDI различаются для каждого пользователя и зависят от многих факторов, включая количество и типы используемых приложений, размеры файлов, количество мониторов и их разрешение.

Подбор моделей графических адаптеров и их количества необходимо провести по результатам анализа рабочих нагрузок пользователей. Выполнять сбор данных о пиковых нагрузках при использовании программного обеспечения которое планируется использовать при работе пользователями в дальнейшем. 

Один физический сервер может иметь 1 и более физических адаптеров NVIDIA, но каждый физический адаптер может быть разделен только на одинаковые виртуальные адаптеры, например: **NVIDIA GRID P100X** можно поделить на 2 **P100X-8Q**, но нельзя поделить на 1 **P100X-8Q** и 2 **P100X-4Q**. Если необходимо использовать на одном сервере разные типы vGPU следует установить под каждый тип vGPU свой графический адаптер.

## Потребление ресурсов ВМ

### vGPU

Подобно переподписке **vCPU:CPU** один физический **GPU** может быть разделен на несколько **vGPU** для использования ВМ при наличии такой поддержки у **GPU**. Для большинства случаев ситуации, когда одновременно несколько (2-3) пользователей будут выполнять операции связанные с высокими нагрузками на **GPU** которые были воспроизведены в ходе тестирования (например рендеринг), являются нетипичными, поэтому коэффициент переподписки **vGPU:GPU** рекомендуется использовать равный 2-3, что приведет к увеличению числа пользователей виртуальных рабочих столов кратно коэффициенту переподписки. Однако, в тех случаях, когда одновременное выполнение задач связанных с высокими нагрузками на **GPU** пользователями является обычной практикой, стоит использовать коэффициент переподписки **vGPU:GPU** равный 1-2.

### Объем памяти vGPU

Рекомендуется, чтобы **объем памяти vGPU**, используемый при выполнении рабочих задач, в пике нагрузки не превышал **70÷90%**. Использование более **90%** памяти **vGPU** виртуальной машиной может привести к снижению производительностью и сбоям.

Определение необходимого объема графической памяти следует производить исходя из системных требований программного обеспечения, а также путем моделирования стандартных рабочих нагрузок. 

### CPU

Так как все процессы, в том числе использующие **GPU**, выполняются с использованием **CPU**, при недостаточном количестве выделенных **vCPU** произойдет снижение производительности. Также при использовании **vGPU** часть задач по кодированию и декодированию видео некоторых популярных кодеков берет на себя **vGPU**, таким образом при выполнении некоторых задач может снижаться нагрузка на CPU. 

Для предовращения снижения производительности по причине высокой очереди на выполнения задач процессорами сервера рекомендуется использовать коэффициент переподписки **CPU:vCPU** в пределах 1-2 при использовании совместо с видеодаптером.

##  Примеры расчетов

В таблице ниже представлены рекомендуемые варианты использования **NVIDIA GRID** в зависимости от типа профиля (рабочих нагрузок) пользователя. Подробная информация о типах профилей содержится в разделе [Профили использования](profiles.md) .

| Профиль                | vCPU | RAM (Mb) | Переподписка vCPU:CPU | vGPU |Переподписка vGPU:GPU |
|:-----------------------|:----:| :-------:|:---------------------:|:----:|:--------------------:|
| Тип 1                  | 2    | 2048     | 8                     |  -   | -                    |
| Тип 2                  | 2    | 4096     | 4                     | 1B   | 16                   |
| Тип 3                  | 4    | 4096     | 4                     | 2B   | 8                    |
| Тип 4                  | 4    | 8192     | 2                     | 4Q   | 4                    |
| Тип 6                  | 8    | 8192     | 2                     | 8Q   | 2                    |
| Тип 6                  | 8    | 16384    | 1                     | 8Q   | 2                    |