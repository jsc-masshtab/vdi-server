# Установка VeiL Broker 3.0.X

## Подготовка к установке
Описание требований и прочая спецификация доступны в разделах:
[Подготовка сервера](../spec/domain-req.md) и [Перечень портов](../spec/ports_info.md)

## Установка брокера

1. Подключить iso-образ **VeiL Broker**
   и выполнить команды для установки
```
sudo mount /media/cdrom
cd ~
sudo bash /media/cdrom/install.sh
sudo umount /media/cdrom
```

1. Установка выполняется около 5 мин, после установки Web-интерфейс VeiL Broker будет доступен по 
   https://server_ip_address. Пользователь и пароль по умолчанию - **vdiadmin - Bazalt1!**

1. Войти в *Панель управления* → *Безопасность* → *Политика безопасности* → *Политики учетной записи* и 
   выполнить настройки создания новых пользователей
   - *Политика создания пользователей* и в качестве первичной группы указать **vdi-web**, а в качестве оболочки 
     **/sbin/nologin**. Снять переключатели *Создавать новую пользовательскую группу* и 
     *Добавлять пользователя в дополнительные группы*
     ![image](../../_assets/vdi/how_to/new_user_scenario.PNG)
   - Войти в раздел *Политики учетной записи* → *Политика паролей* и активировать переключатель 
     *Применять для пользователя root*
     ![image](../../_assets/vdi/how_to/password_policy.PNG)

### Настройка PAM
Pluggable Authentication Modules (PAM, подключаемые модули аутентификации) — это набор разделяемых библиотек, 
которые позволяют интегрировать различные низкоуровневые методы аутентификации в виде единого высокоуровневого API.
При стандартной установке VeiL Broker параметр **PAM_AUTH** включен, что позволяет переложить функции локальной службы
авторизации на Astra linux в котором выполнена установка. Сам процесс настройки **PAM** в системе не является
параметрами VeiL Broker, однако, за основу можно взять следующий пример:

!!! example "/etc/pam.d/common-auth"
    ```
    # force vdi-web check
    auth required pam_succeed_if.so user ingroup vdi-web
    ```    

!!! example "/etc/pam.d/login"
    ```
    # change default delay
    auth optional pam_faildelay.so delay=1000000
    ```

!!! warning "Предупреждение"
    Не забудьте добавить в указанную группу пользователя под которым выполняется вход в GUI для администрирования.

Дальнейшее описание работы с системой авторизации доступно по [ссылке](../auth_v3/info.md).
