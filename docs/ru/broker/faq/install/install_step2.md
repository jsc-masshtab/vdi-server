# Создание ВМ

Для создания новой ВМ необходимо выбрать раздел **Виртуальные машины** основного меню интерфейса 
управления ECP VeiL и нажать кнопку **Добавить ВМ**, после чего откроется окно мастера создания ВМ, 
в котором с помощью кнопок навигации **Дальше** или **ОК** необходимо пройти все этапы 
создания ВМ, последовательно заполняя поля информацией. В процессе
создания производится первоначальная настройка ВМ, необходимая для
ее корректного запуска.

Можно создать ВМ на базе ранее созданного шаблона. Для этого в окне **Создание виртуальной машины** необходимо: 

   - выбрать **Перейти к созданию тонких клонов из шаблона**;
   - в открывшемся окне указать название ВМ (необязательно);
   - выбрать шаблон ВМ из раскрывающегося списка ранее созданных ВМ (при необходимости отредактировать параметры);
   - выбрать количество создаваемых ВМ (максимально 100);
   - при необходимости активировать опцию включения после создания (произойдет после создания всех ВМ);     
   - подтвердить операцию, нажав кнопку **OK**.

В процессе создания ВМ необходимо выполнить следующие шаги:

## Первый шаг — настройка параметров ВМ
    
-   выбрать из раскрывающегося списка локацию и кластер;

-   выбрать из раскрывающегося списка сервер при ручном выборе или в
    автоматическом режиме будет предложен наименее загруженный сервер
    первоначального размещения;

-   указать название ВМ;

-   указать режим определения процессора (оптимальный процессор определяется по наименьшему совпадению 
    функций (флагов) процессоров всех узлов кластера);
       
-   указать количество ядер CPU;

-   указать максимальное количество потоков CPU;
    
-   выбрать из раскрывающегося списка приоритет предоставления ресурсов
    CPU – «LOW», «MEDIUM» или «HIGH»;

-   указать количество выделяемой оперативной памяти;

-   выбрать из раскрывающегося списка тип операционной системы – «Windows», «Lunix» или «Other»;

-   выбрать из раскрывающегося списка версию операционной системы;

-   выбрать чипсет;

-   выбрать видеокарту:

     *  тип эмулируемого видео адаптера из раскрывающегося списка - «vga», «cirrus», «gxl» 
        или «virtio»;
    
     *  объем памяти из раскрывающегося списка – «16», «32», «64», «128», «256» или «512»;
    
     *  количество мониторов из раскрывающегося списка;

-   выбрать звуковую карту:

     *  тип эмулируемой аудио карты из раскрывающегося списка – «es1370», «sb16», «ac97», 
        «ich6» или «usb»;

     *  кодек из раскрывающегося списка – «micro» или «duplex»;

-   выбрать тип загрузчика – «LegacyMBR» или «UEFI»;

-   заполнить описание (при необходимости).

!!! note "ВМ для VeiL Broker"
    Для дальнейшей установки **VeiL Broker** необходимо выбрать следующие параметры:  
    - количество ядер CPU - не менее **4**;  
    - приоритет CPU – из раскрывающегося списка выбрать приоритет **HIGH**;  
    - размер RAM – не менее **4096 Мбайт**;  
    - операционная система – из раскрывающегося списка выбрать ОС **Linux**;  
    - версия операционной системы – из раскрывающегося списка выбрать версию ОС **Astra Smolensk (64-bit)**.
  
!!! attention "Внимание"
    Не рекомендуется превышать количество ресурсов физически присутствующих
    на узле (сервере), на котором создается ВМ. Необходимо учитывать, что
    при переносе (миграции) на целевом узле должно быть не меньше физических
    ресурсов, чем присвоено ВМ. В противном случае ВМ не будет запускаться
    до исправления ошибки. Если на целевом сервере будет недостаточно
    свободных ресурсов для запуска ВМ, то она также не запустится.

Для сохранения изменений необходимо нажать кнопку **OK** и
виртуальная машина с заданными параметрами будет создана, но мастер
создания ВМ не закроется.

Следующими шагами мастера по созданию ВМ будут:

-  создание нового или подключение ранее созданного виртуального диска ВМ;

-  монтирование в виртуальный CD-ROM образ CD/DVD-диска, загруженного в
   хранилище;

-  создание виртуального сетевого адаптера ВМ и подключение его к
   виртуальной сети, к ранее созданному распределенному коммутатору в
   созданную на нем группу интерфейсов.

!!! note "Примечание"
    Каждый из этих шагов можно пропустить или закрыть мастер
    создания ВМ. В таком случае, все настройки ВМ, которые были пропущены,
    возможно произвести в окне управления ВМ.

При последовательной настройке ВМ с помощью мастера создания ВМ
необходимо перейти к шагу 2.

## Второй шаг — подключение дисков

Имеется две возможности:
    
-  создать новый виртуальный диск;

-  добавить существующий.

Для дальнейшей установки **VeiL Broker**  необходимо нажать кнопку **Создать новый** и в открывшемся окне выбрать пул 
данных, на котором находится импортированные iso-образы дисков, задать название, описание и размер виртуального 
диска равный **40 Гбайт**, выбрать тип шины - **virtio**, тип кеширования - **none**. 

Для подтверждения изменений, нажать кнопку **ОК**. Название и параметры вновь созданного виртуального диска 
появятся в списке виртуальных дисков. 

Нажать кнопку **Дальше** для перехода к шагу 3.

## Третий шаг — подключение ISO
    
-   для установки ОС;

-   для запуска с live-CD.

Для дальнейшей установки **VeiL Broker** необходимо выполнить [подключение ISO-образа](install_step3.md).
    
Нажать кнопку **Дальше** для перехода к шагу 4.

## Четвертый шаг — создание сетевых интерфейсов

Для создания сетевого интерфейса необходимо нажать кнопку
**Добавить** и в открывшемся окне **Добавить виртуальный интерфейс** 
заполнить следующие поля:

   - виртуальная сеть (выбор из раскрывающегося списка). Необходимо выбрать 
     виртуальную сеть, имеющую доступ к IP-адресу управления контроллером **ECP VeiL**;   
  
   - MAC-адрес. Поле *МАС-адрес* является необязательным для
     заполнения. Если не указывать MAC-адрес, то он будет сгенерирован
     автоматически;
    
   - сетевую карту (выбор из раскрывающегося списка). В качестве модели
     сетевой карты можно выбрать «virtio», «e1000», «rtl8139» или «vmxnet3», в зависимости
     от поддерживаемых вариантов в устанавливаемой ОС;

   -  описание виртуального интерфейса (при необходимости).    
    
Для сохранения изменений необходимо нажать кнопку **Отправить**. Для
перехода к шагу 5 нажать кнопку **Дальше**.

## Пятый шаг — Включение

Выбор опции запуска ВМ после создания (включить или не
включить питание ВМ). Для подтверждения операции
необходимо нажать кнопку **Готово**.

После этого происходит возврат в окно со списком ВМ.

При нажатии на уже существующую ВМ открывается окно, в котором
содержится информация о ней.

После окончания создания ВМ, во избежание проблем с мышкой, необходимо сменить графический 
адаптер на **virtio**, добавить новый USB2.0 контроллер **ehci**, а затем удалить базовый USB3.0 контроллер 
**nec xhci**. 

!!! note "Примечание" 
    Для корректной работы мышки после установки ОС рекомендуется установить гостевого 
    агента **Агент Veil** (ИСКП.30323-01).

После окончания создания ВМ необходимо проверить порядок загрузки устройств. 
В разделе **Виртуальные машины** - <название ВМ> - **Опции загрузки** в окне управления 
загрузчиком используемое при загрузке устройство с образом установочного диска должно стоять первым.


