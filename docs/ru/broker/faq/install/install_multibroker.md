#  Установка мультиброкера

## Порядок установки

1. Для установки **VeiL Broker 5.0.х** (версия с функциями мультиброкера) необходимо вставить установочный диск **VeiL Broker 5.0.x** в DVD-ROM физической машины или 
   зайти в окно управления **ECP VeiL**, перейти во вкладку **Виртуальные машины** - <имя ВМ> - **CD-ROM**.
 
   В списке приводов нажать на название привода и в открывшемся диалоговом окне выполнить следующие действия:

    - примонтировать iso-образ установочного диска **VeiL Broker** (образ доступен в вашем ЛК или по ссылке http://192.168.10.144/veil-broker-iso/dev/), нажав кнопку 
      **Монтировать образ**;
    - откроется окно **Монтирование iso-образа**, в котором необходимо выбрать тип хранилища, 
      его наименование и iso-образ установочного диска **VeiL Broker**;
    - для сохранения изменений нажать кнопку **Монтировать**.

2. Авторизоваться в ВМ.
3. Подключиться на своем АРМе к любому свободно распространяемому клиенту для различных протоколов удаленного доступа, включая SSH. 
   Все дальнейшие действия выполняются через этот клиент.
4. Перейти в окно приложения для ввода командной строки **Терминал Fly**.
5. Выполнить следующие действия:
   
    `sudo mount /media/cdrom`
   
    `sudo bash /media/cdrom/install.sh multi manager`

    После установки manager на экран консоли будет выведен токен для подключения новых рабочих мест (worker's), его необходимо 
    скопировать в любой текстовый документ для дальнейшего использования.

    Далее установить worker's на другой машине с ОС **Astra Linux SE 1.7**. Для мультиброкера необходимо задать следующие аргументы:
   
    `install.sh multi worker [manager_ip] [join_token]`
    
    Команды для установки worker's (параметры приведены в качестве примера):

     `sudo mount /media/cdrom`
   
     `sudo bash /media/cdrom/install.sh multi worker 192.168.6.44 SWMTKN-1-3xhz573o9gfz7e78lhm5gyoelmf5jkotwf9d6mtt54tx79wii4-4o13crwblvwidg12nz8v8z5wf`

## Команды для просмотра

Чтобы посмотреть список узлов в кластере на машине manager, необходимо выполнить команду

`sudo docker node ls`

Чтобы посмотреть список сервисов Брокера на машине manager, необходимо выполнить команду

`sudo docker stack services multibroker`
