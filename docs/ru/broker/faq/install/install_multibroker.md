#  Установка мультиброкера

## Порядок установки

1. Вставить установочный диск **VeiL Broker 4.1.x** в DVD-ROM физической машины или примонтировать [ISO-образ VeiL Broker](http://192.168.10.144/veil-broker-iso/dev/veil-broker-dev-4.1.0-20220908182153-311.iso) в ВМ.
2. Авторизоваться в ВМ.
3. Подключиться на своем АРМе к любому свободно распространяемому клиенту для различных протоколов удаленного доступа, включая SSH. 
   Все дальнейшие действия выполняются через этого клиента.
4. Перейти в окно приложения для ввода командной строки **Терминал Fly**.
5. Выполнить следующие действия:
    `sudo mount /media/cdrom`
   
    `sudo bash /media/cdrom/install.sh multi manager`

    После установки manager на экран консоли будет выведен токен для подключения новых рабочих мест (worker's), его необходимо запомнить.

    Далее установить worker's на другой машине с ОС **Astra Linux SE 1.7**. Для мультиброкера необходимо задать следующие аргументы:
   
    `install.sh multi manager|worker [manager_ip] [join_token]`
    
    Команды для установки worker's (параметры приведены в качестве примера):

     `sudo mount /media/cdrom`
   
     `sudo bash /media/cdrom/install.sh multi worker 192.168.6.44 SWMTKN-1-3xhz573o9gfz7e78lhm5gyoelmf5jkotwf9d6mtt54tx79wii4-4o13crwblvwidg12nz8v8z5wf`

## Команды для просмотра

Чтобы посмотреть список узлов в кластере на машине manager, необходимо выполнить команду

`sudo docker node ls`

Чтобы посмотреть список сервисов Брокера на машине manager, необходимо выполнить команду

`sudo docker stack services multibroker`
