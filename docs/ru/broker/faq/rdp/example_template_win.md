# Windows 8.1/10

### 1. Создание ВМ 

Создайте ВМ в соответствии с [руководством оператора ECP VeiL](https://veil.mashtab.org/docs/base/operator_guide/domains/create).


   Перед созданием ВМ необходимо загрузить в пул данных iso-образ установочного диска **Windows 10/8.1** и 
   образ [**veil-guest-utils.iso**](https://veil-update.mashtab.org/veil_agent/veil-guest-utils-latest.iso) — необходимый набор драйверов и дополнительного программного обеспечения, которое 
   требуется для установки и дальнейшей работы ВМ. 
   
   В мастере создания ВМ нужно указать параметры:

   - выбрать тип видеокарты **_QXL_**;
     
   - в **Управлении виртуальными дисками** создать диск тип шины **_VIRTIO_**;
     
   - в **Управление приводом cd-rom** к текущему приводу монтируем установочный образ **Windows 10/8.1**, 
     который был загружен в один из доступных пулов **ECP VeiL**. Дополнительно добавляем cd-rom и 
     монтируем образ **veil-guest-utils.iso**;
     
   - в **Управлении виртуальными интерфейсами** выбираем виртуальную сеть и сетевой драйвер 
     типа **_VIRTIO_**. 
     
   ВМ готова для включения. 
   
   Во время установки Windows 8.1/10 для определения 
    дискового пространства нужно указать расположения драйверов для шины типа **_VIRTIO_**, 
    которые находятся на смонтированном образе **veil-guest-utils.iso**. Нажимаем **Загрузить → Обзор**, 
    откроется проводник, в котором переходим в папку с драйверами для шины типа **_VIRTIO_** 
    `veil-guest-utils\windows\virtio\amd64\w10`. Драйвер будет загружен и нажимаем **Далее**. 
    Диск определился, установку продолжаем до полной инсталляций ОС.

### 2. Установка необходимого ПО для работы ВМ

   После завершения установки ОС необходимо установить все 
    [драйверы и агенты](../../../broker/vm/guest_agent.md).
    Переходим на смонтированный диск **veil-guest-utils-.iso** и запускаем приложение **install-menu.exe**. 
    Будет запущен мастер установки и устанавливаем необходимые 
    агенты и драйверы.
   
   После установки ПО создаем административную 
    локальную учетную запись, открываем службы Windows, настраиваем запуск службы qemu-агента от 
    административной учётной записи и перезапускаем службу. После запускаем обновление ОС. Устанавливаем ПО. 
    Перезагружаем ВМ.

### 3. Оптимизация ОС, используя VMware OS Optimization Tool


   После того, как ОС обновилась и было установленно необходимое ПО, требуется оптимизировать ВМ для работы в виртуальной
    среде. Переходим на сайт **VMware OS Optimization Tool** и загружаем данное приложение. В ВМ запускаем приложение 
   **Vmware OS Optimization Tool**. Во вкладке **Optimize** выбираем шаблон для **Windows 10** и нажимаем на кнопку **Analyze**. 
    Следующим шагом нажимаем **Common Options**, будет запущено окно **Select Option**, где выбираем вкладку 
    **Visual Effect** и выбираем режим **_Best performance_**. Нажимаем **OK**. Нажимаем  **Optimize**, 
    по окончании процесса оптимизаций приложение закрываем и перезагружаем ВМ.

!!! warning "Внимание!"
    Приложение **VMWare OS Optimization Tool** не удаляем, т.к. у приложения есть механизм отката на состояние 
    **_до оптимизаций_**.

### 4. Добавление пользователей в группу удалённых рабочих столов для подключения по «RDP» к ВМ в рабочей группе

   Для создания пользователей в шаблоне ВМ переходим в оснастку Windows **Управление компьютером**.
    Заходим на ВМ с административной учётной записью и выполняем команду `compmgmt.msc`. 
   
   В разделе **Управление компьютером** переходим в **Локальные пользователи и группы → Пользователи**.
    Создаём необходимое количество локальных пользователей.
    
Для добавления созданных локальных пользователей в группу удалённых рабочих столов переходим в раздел
    **Управление компьютером → Локальные пользователи и группы → Пользователи → Пользователи удалённого 
    рабочего стола**. В окне **Свойства: Пользователи удалённого рабочего стола** добавляем 
    пользователей в группу.
