# Автоматический пул (VeiL Broker v.2)

## Подготовительные шаги
1. Подготовить базовый шаблон ВМ (Windows 10) [veil-guest-utils](../vm/guest_agent.md)
1. Настроить [расширенную интеграцию](../active_directory/ad_extend.md) с MS AD на брокере

## Создание автоматического пула
Создание автоматического пула производится с помощью кнопки **Добавить пул** в разделе **Пулы** панели администратора.
В открывшемся окне необходимо заполнить следующие поля:
- Имя пула
- Тип подключения (типы подключения к ВМ в пуле которые будут доступны тонкому клиенту)
- Контроллер (контроллер, ранее добавленный в систему, на котором будет происходить создание ВМ)
- Кластер (кластер выбранного контроллера)
- Сервер (сервер на кластере ранее выбранного контроллера)
- Пул данных (пул данных выбранного контроллера)
- Шаблон ВМ (шаблон, на основе которого будут создаваться ранее выбранные ВМ)

!!! warning "Шаблон ВМ"
    С шаблоном одновременно может происходить только одно действие, если Вы планируете создавать сразу
    несколько пулов, то выполняйте создание последовательно.
  
- Наименование групп для добавления ВМ в AD (указание на наименование контейнера для MS AD в который необходимо
  включить созданные ВМ при подготовке).
  
!!! note "Наименование групп для добавления ВМ в AD"
    Если необходимость включения ВМ в группы отсутствует — оставьте поле пустым, тогда этот шаг будет пропущен.

- Начальное количество ВМ (столько машин будет создано вместе с пулом)
- Максимальное количество создаваемых ВМ (максимальная размерность пула)
- Шаг расширения пула (столько ВМ будет создаваться при расширении пула)
- Пороговое количество свободных ВМ (значение при достижении которого будет запущено автоматическое расширение пула)
- Создать тонкие клоны (атрибут используемый при создании ВМ из шаблона)
- Подготавливать ВМ (атрибут указывающий на необходимость запуска процедуры подготовки ВМ после их создания) 
!!! warning "Подготавливать ВМ"
    Если на пуле отсутствовал данный параметр в момент создания, то действовать он начнет только после его активации
    и для ВМ созданных **ПОСЛЕ**.

!!! example "Пример формы создания автоматического пула"
    ![image](../../../_assets/vdi/active_directory/autopool_prepare_1.png)
    ![image](../../../_assets/vdi/active_directory/autopool_prepare_2.png)

!!! note "Подготовка ВМ"
    Если в процессе создания пула подготовились не все ВМ или необходимо выполнить подготовку по изменившимся параметрам,
    в разделе **Информация** виртуальной машины созданного пула (**Пулы -> Виртуальные машины -> щелчок ЛКМ по нужной ВМ**)
    есть кнопка **Подготовить ВМ**. Данная кнопка продолжит подготовку ВМ с последнего успешного действия. 

!!! warning "Удаление ВМ"
    Если пул или ВМ были удалены — не забудьте вывести ВМ из MS AD.    